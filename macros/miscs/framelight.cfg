[gcode_macro SET_CASELIGHT_LEDS_ON]
gcode:
    {% set transmit = params.TRANSMIT|default(1) %}

    {% if printer["gcode_macro _USER_VARIABLES"].status_leds_caselight_enabled %}
        {% set color_name = params.COLOR|default('on')|lower %}
        _SET_ALLLEDS_BY_NAME LEDS="caselight" COLOR={color_name} TRANSMIT=1
    {% elif printer["gcode_macro _USER_VARIABLES"].light_enabled %}
        LIGHT_ON
    {% endif %}

[gcode_macro SET_CASELIGHT_LEDS_OFF]
gcode:
    {% set transmit = params.TRANSMIT|default(1) %}

    {% if printer["gcode_macro _USER_VARIABLES"].status_leds_caselight_enabled %}
        _SET_ALLLEDS_BY_NAME LEDS="caselight" COLOR="off" TRANSMIT={transmit}
    {% elif printer["gcode_macro _USER_VARIABLES"].light_enabled %}
        LIGHT_OFF
    {% endif %}

[gcode_macro _STOP_CASELIGHT_LAYER_CHANGE]
gcode:
    {% set cur_layers = printer.print_stats.info.current_layer|int %}
    {% set caselight_off_layer_height = params.LAYER|default(2)|int %}

    {% if printer['gcode_macro _USER_VARIABLES'].caselight_off_layer_enabled %}
        {%if cur_layers > caselight_off_layer_height %}
            SET_CASELIGHT_LEDS_OFF
        {% endif %}
    {% endif %}

[gcode_macro _RESET_LAYER_GCODE]
description: Clears scheduled gcode commands and state for all layers.
  Usage: _RESET_LAYER_GCODE
gcode:
  SET_PRINT_STATS_INFO TOTAL_LAYER="{0}" CURRENT_LAYER="{0}"
