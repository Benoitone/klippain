[gcode_macro SET_CASELIGHT_LEDS_ON]
description: Start case light - In case you have!!!
  Usage: for fcbo white light: SET_CASELIGHT_LEDS_ON
  Usage: for neopixel light:   SET_CASELIGHT_LEDS_ON COLOR= (optional COLOR default is "on")
gcode:
    {% set transmit = params.TRANSMIT|default(1) %}
    {% set status_leds_caselight_enabled = printer["gcode_macro _USER_VARIABLES"].status_leds_caselight_enabled %}
    {% set light_enabled = printer["gcode_macro _USER_VARIABLES"].light_enabled %}

    {% if status_leds_caselight_enabled %}
        {% set color_name = params.COLOR|default('on')|lower %}
        _SET_ALLLEDS_BY_NAME LEDS="caselight" COLOR={color_name} TRANSMIT=1
    {% elif light_enabled %}
        LIGHT_ON
    {% else %}
        RESPOND MSG="No caselight !!!"
    {% endif %}

[gcode_macro SET_CASELIGHT_LEDS_OFF]
description: Stop case light - In case you have!!!
gcode:
    {% set transmit = params.TRANSMIT|default(1) %}
    {% set status_leds_caselight_enabled = printer["gcode_macro _USER_VARIABLES"].status_leds_caselight_enabled %}
    {% set light_enabled = printer["gcode_macro _USER_VARIABLES"].light_enabled %}

    {% if status_leds_caselight_enabled %}
        _SET_ALLLEDS_BY_NAME LEDS="caselight" COLOR="off" TRANSMIT={transmit}
    {% elif light_enabled %}
        LIGHT_OFF
    {% else %}
        RESPOND MSG="No caselight !!!"
    {% endif %}

[gcode_macro _STOP_CASELIGHT_LAYER_CHANGE]
description: Stop case light at define layer (X).
  Usage: _STOP_CASELIGHT_LAYER_CHANGE LAYER=X 
gcode:
    {% set status_leds_caselight_enabled = printer["gcode_macro _USER_VARIABLES"].status_leds_caselight_enabled %}
    {% set light_enabled = printer["gcode_macro _USER_VARIABLES"].light_enabled %}
    {% set cur_layers = printer.print_stats.info.current_layer|int %}
    {% set caselight_off_layer_height = params.LAYER|default(2)|int %}

    {% if status_leds_caselight_enabled or light_enabled %}
        {%if cur_layers > caselight_off_layer_height %}
            SET_CASELIGHT_LEDS_OFF
        {% endif %}
    {% else %}
        RESPOND MSG="No caselight initialised in Klippain !!!"
    {% endif %}

[gcode_macro _RESET_LAYER_GCODE]
description: Clears scheduled gcode commands and state for all layers.
  Usage: _RESET_LAYER_GCODE
gcode:
    SET_PRINT_STATS_INFO TOTAL_LAYER="{0}" CURRENT_LAYER="{0}"
